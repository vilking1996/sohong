<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Menu QR Hóa đơn</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    html, body { margin:0; padding:0; height:100vh; background:#000; color:#fff; font-family:sans-serif; }
    #menu-container { display:flex; flex-direction:column; height:100%; padding:10px; background:#111; overflow:auto; position:relative; }
    .menu-grid { display:grid; grid-template-columns:repeat(5,1fr); gap:6px; }
    .menu-item { border:2px solid #444; border-radius:8px; overflow:hidden; position:relative; }
    .menu-item.selected { border-color:#0f0; transform:scale(1.02); }
    .menu-item img { width:100%; height:60px; object-fit:cover; }
    .menu-item div { text-align:center; padding:5px; font-size:0.75em; }
    .menu-item input { position:absolute; bottom:2px; left:2px; font-size:10px; opacity:0.8; }
    #invoice { margin-top:8px; background:#000; padding:6px; border-radius:6px; font-size:0.8em; }
    #invoice img { width:40px; height:30px; margin:1px; object-fit:cover; border-radius:4px; }
    #qrcode { margin-top:6px; position:relative; text-align:center; }
    #qr-label { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); color:#0f0; font-weight:bold; font-size:14px; pointer-events:none; }

    #guideBtn {
      position: absolute; top: 10px; right: 10px;
      background: #0f0; color: #000;
      border: none; padding: 6px 10px;
      border-radius: 5px; font-weight: bold;
      z-index: 10;
    }
    #guideBox {
      display: none;
      position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.95);
      padding: 20px; color: #0f0;
      border: 2px solid #0f0;
      border-radius: 12px;
      width: 90%; max-width: 300px;
      animation: glow 1s infinite alternate, bounce 1s infinite;
      z-index: 999;
    }
    @keyframes glow {
      from { box-shadow: 0 0 5px #0f0, 0 0 10px #0f0; }
      to   { box-shadow: 0 0 20px #0f0, 0 0 40px #0f0; }
    }
    @keyframes bounce {
      0%, 100% { transform: translate(-50%, -50%) scale(1); }
      50%      { transform: translate(-50%, -52%) scale(1.05); }
    }
  </style>
</head>
<body>
  <div id="menu-container">
    <button id="guideBtn" onclick="toggleGuide()">Hướng dẫn</button>
    <div class="menu-grid" id="menuGrid"></div>
    <div id="invoice"></div>
    <div id="qrcode"><div id="qr-label">Ben177<br>Stormwind255</div></div>
  </div>
  <div id="guideBox">
    <strong>HƯỚNG DẪN SỬ DỤNG:</strong><br><br>
    - Nhấn vào "Upload" để chọn ảnh món ăn (ví dụ: BòNướng177255 177.png)<br>
    - Tên món sẽ lấy phần chữ, giá sẽ lấy phần số (177255= 177.255đ)<br>
    - Sau khi tải ảnh, click để chọn món<br>
    - Hệ thống sẽ tự tạo hóa đơn và mã QR<br><br>
    <button onclick="toggleGuide()">Đóng</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
  <script>
    const menuItems = Array(25).fill().map(() => ({name:'', price:0, img:''}));
    const menuGrid = document.getElementById('menuGrid');
    const invoiceEl = document.getElementById('invoice');
    const qrContainer = document.getElementById('qrcode');

    for(let i=0; i<25; i++){
      const div = document.createElement('div'); div.className='menu-item';
      div.innerHTML = `
        <img src="https://placehold.co/100x60?text=Upload" id="img${i}" />
        <input type="file" accept="image/*" onchange="onUpload(event,${i})" />
        <div id="lbl${i}">---</div>`;
      div.addEventListener('click', ()=> toggleSelect(i, div));
      menuGrid.appendChild(div);
    }

    function onUpload(e,i){
      const file=e.target.files[0]; if(!file)return;
      const reader=new FileReader();
      reader.onload = ev=>{
        menuItems[i].img = ev.target.result;
        document.getElementById('img'+i).src = ev.target.result;

        const name = file.name.replace(/\.[^/.]+$/, "");
        const m = name.match(/^([a-zA-ZÀ-ỹ\s_-]+?)(\d+)$/);
        if(m){
          const rawName = m[1].replace(/[-_]/g, '').trim();
          const price = parseInt(m[2]);
          menuItems[i].name = rawName;
          menuItems[i].price = price;
          document.getElementById('lbl'+i).innerText = `${rawName} - ${price.toLocaleString()}đ`;
        }
      };
      reader.readAsDataURL(file);
      e.stopPropagation();
    }

    function toggleSelect(i, div){
      if(menuItems[i].price > 0 && menuItems[i].name){
        div.classList.toggle('selected');
        updateInvoice();
      }
    }

    function updateInvoice(){
      const sel = [...menuGrid.querySelectorAll('.menu-item.selected')];
      invoiceEl.innerHTML = ''; qrContainer.querySelector('canvas')?.remove();
      if(sel.length===0)return;

      let total=0, time=new Date().toLocaleString();
      let text=`HÓA ĐƠN: Ben177 Stormwind255\n${time}\n`;
      let html=`<strong>Hóa đơn Ben177 Stormwind255</strong><br><br>`;
      sel.forEach(div=>{
        const idx=[...menuGrid.children].indexOf(div);
        const it=menuItems[idx];
        total += it.price;
        html+=`<img src="${it.img}"/><br>${it.name} - ${it.price.toLocaleString()}đ<br>`;
        text+=`- ${it.name}: ${it.price.toLocaleString()}đ\n`;
      });
      html+=`<hr><strong>Tổng: ${total.toLocaleString()}đ</strong>`;
      text+=`TỔNG TIỀN: ${total.toLocaleString()}đ`;
      invoiceEl.innerHTML=html;

      QRCode.toCanvas(document.createElement('canvas'), text, {
        width: 240,
        color:{dark:"#00FF00", light:"#000"}
      }, (e,cn)=>{
        if(!e) qrContainer.insertBefore(cn, document.getElementById('qr-label'));
      });
    }

    function toggleGuide(){
      const box = document.getElementById('guideBox');
      box.style.display = (box.style.display === 'none' || box.style.display === '') ? 'block' : 'none';
    }
  </script>
</body>
</html>

